<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Music code player</title>
<script src='js/sound.js'></script>
<script src='js/player.js'></script>
<script src='js/parser.js'></script>
<script src='js/assembler.js'></script>
<link rel='stylesheet' href='css/player.css'>
<link rel='stylesheet' href='css/alertbox.css'>
</head>
<body>
<h1>Music Code Player</h1>
<p>Select a song: <select id="song" onchange="changeSong()">
  <optgroup label="Builtin">
    <option value="bTwinkle">Twinkle Twinkle Little Star</option>
    <option value="bYee">Yee</option>
    <option value="bLittleBee">Little Bee</option>
  </optgroup>
  <optgroup label='custom'>
    <option value="new">New...</option>
  </optgroup>
</select></p>
<div id='divEditMode'>
  <p>Music format:
    <select id="format">
      <option value="mml">Music Macro Language</option>
      <option value="mascii">Mascii</option>
    </select>
  </p>
  <textarea id="codeIn" style="width: 15em; height: 15em;"></textarea>
  <p>
    <input type='button' value='Play' onclick='gotoMode("play")'>
    <input type='button' value='Save' onclick='save()'>
    <input type='button' value='Delete' onclick='del()'>
    <a href='help.html'>Help!</a>
  </p>
</div>
<div id='divPlayMode' style='display:none;'>
  <p>
    <input type='button' value='Edit' onclick='gotoMode("edit")'>
    <input type='button' value='Save' onclick='save()'>
    <input type='button' value='Delete' onclick='del()'>
    <a href='help.html'>Help!</a>
  </p>
  <p>
    <input type='button' id='btnPlayPause' value='Play' onclick='togglePlayPause()'>
    <input type='button' value='Stop' onclick='stop()'>
    <label><input type='checkbox' id='chkLoopMusic'>Loop Music</label>
  </p>
  <p>
    <input type='range' min='0' max='1' value='0' step='0.1' oninput='console.log("changing")' onmouseup='console.log(this.value)'><span>0:00/0:00</span>
  </p>
  <p>Music format: None</p>
  <p>
    Code:
    <input type='button' id='btnToggleCode' value='Hide' onclick='toggleCode()'>
    <pre id='codeOut'>code
code</pre>
  </p>
</div>

<!-- alert box -->
<div class="center-of-screen grayed-out" id='prompt' style='visibility: hidden; align-items: baseline;'>
  <form class='prompt-box' action="javascript:void 3">
    <div class='description' id='promptMessage'></div>
    <input id='promptInput'>
    <div class='yesno'>
      <button onclick="promptCallback(true)">OK</button>
      <button onclick="promptCallback(false)" id='promptCancel'>Cancel</button>
    </div>
  </form>
</div>
<!--[if IE]>
<div id='alert' class='alert-box alert-box-ie'>
<![endif]-->
<!--[if !IE]> -->
<div id='alert' class='alert-box' style='visibility: hidden;'>
<!-- <![endif]-->
  <div class='title'>
    <span>Error</span>
    <input id='close' class='x' value='X' type='button'>
  </div>
  <!--[if IE]>
  <pre class='description' id='description'>
本網頁不支援IE。請改用Firefox或Chrome
This website does not support IE. Please use Firefox or Chrome.
  </pre>
  <![endif]-->
  <!--[if !IE]> -->
  <pre class='description' id='description'>
錯誤訊息會顯示在這裡
  </pre>
  <!-- <![endif]-->
</div>
<script src='js/alertbox.js'></script>
<!-- end of alert box -->

<script>
function gotoMode(mode){
  divPlayMode.style.display = "none";
  divEditMode.style.display = "none";
  if(mode == "play"){
    divPlayMode.style.display = "";
    window.asm = MMLAssembler(codeIn.value);
    asm.musicToNotes();
    togglePlayPause();
  }
  if(mode == "edit"){
    divEditMode.style.display = "";
  }
}

function toggleCode(){
  if(codeOut.style.display == 'none') {
    codeOut.style.display = '';
    btnToggleCode.value = "Hide";
  }
  else {
    codeOut.style.display = 'none';
    btnToggleCode.value = "Show";
  }
}
var isPlaying = false;
function togglePlayPause(){
  if (isPlaying) {
    btnPlayPause.value = "Play";
    isPlaying = false;
  }
  else {
    btnPlayPause.value = "Pause";
    play();
    isPlaying = true;
  }
}
</script>
</body>
</html>
